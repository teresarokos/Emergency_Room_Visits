---
title: "Final Project Precis"
author: "Teresa Rokos"
date: "10/16/2018"
output: html_document
---

## Project Idea
The Medical Expenditure Panel Survey (MEPS) data contain detailed information on emergency room visits. I would hope to make a web app that allows users to explore this data through tables and visualizations generated by predictive models for how much an emergency room visit with certain characteristics is likely to cost.

### Medical Expenditure Panel Survey (MEPS) Emergency Room Visits Data
The MEPS Emergency Room Visits File provides detailed information on emergency room visits. Data are gathered from a nationally representative sample of the civilian, noninstitutionalized population of the United States and can be used to make estimates of emergency room utilizations and expenditures for calendar year 2016. Each record represents one, household-reported, emergency room visit reported during the calendar year 2016 and the data contains characteristics such as, the date of the visit, types of care and services received, types of medicine prescribed during the visit, condition codes, expenditures, and sources of payment associated with the visit. (information from [MEPS website](https://meps.ahrq.gov/mepsweb/data_stats/download_data_files_detail.jsp?cboPufNumber=HC-188E) )
```{r, echo = FALSE, message=FALSE, error=FALSE, warning=FALSE, results='hide'}

# MEPS had instructions on how to import their data (which only existed in .dat and .ssp files) into STATA, so I used their provided code in a .do file and generated a .dta file of the data titled "H188E.dta" that I can now read into R.

library(tidyverse)
library(readstata13)
library(knitr)
library(janitor)

emergency_visits_data <- read.dta13("H188E.dta", nonint.factors = TRUE)
glimpse(emergency_visits_data)
summary(emergency_visits_data)

names(emergency_visits_data) <- c("DWELLING UNIT ID",
  "PERSON NUMBER",
  "PERSON ID (DUID + PID)",
  "EVENT ID",
  "EVENT ROUND NUMBER",
  "EVENT ID FOR CORRESPONDING HOSPITAL STAY",
  "FLAT FEE ID",
  "PANEL NUMBER",
  "MPC DATA FLAG",
  "EVENT DATE - YEAR",
  "EVENT DATE - MONTH",
  "BEST CATEGORY FOR CARE P RECV ON VST DT",
  "THIS VST RELATED TO SPEC CONDITION",
  "THIS VISIT DID P HAVE LAB TESTS",
  "THIS VISIT DID P HAVE SONOGRAM OR ULTRSD",
  "THIS VISIT DID P HAVE X-RAYS",
  "THIS VISIT DID P HAVE A MAMMOGRAM",
  "THIS VISIT DID P HAVE AN MRI/CATSCAN",
  "THIS VISIT DID P HAVE AN EKG OR ECG",
  "THIS VISIT DID P HAVE AN EEG",
  "THIS VISIT DID P RECEIVE A VACCINATION",
  "THIS VISIT DID P RECEIVE ANESTHESIA",
  "THIS VISIT DID P HAVE A THROAT SWAB",
  "THIS VISIT DID P HAVE OTH DIAG TEST/EXAM",
  "WAS SURG PROC PERFORMED ON P THIS VISIT",
  "ANY MEDICINE PRESCRIBED FOR P THIS VISIT",
  "MODIFIED CLINICAL CLASSIFICATION CODE",
  "MODIFIED CLINICAL CLASSIFICATION CODE",
  "MODIFIED CLINICAL CLASSIFICATION CODE",
  "MODIFIED CLINICAL CLASSIFICATION CODE",
  "FLAT FEE BUNDLE",
  "TOTAL # OF VISITS IN FF BEFORE 2016",
  "TOT EXP FOR EVENT (ERFXP16X + ERDXP16X)",
  "TOTAL CHG FOR EVENT (ERFTC16X+ERDTC16X)",
  "FACILITY AMT PD, FAMILY (IMPUTED)",
  "FACILITY AMT PD, MEDICARE (IMPUTED)",
  "FACILITY AMT PD, MEDICAID (IMPUTED)",
  "FACILITY AMT PD, PRIV INSUR (IMPUTED)",
  "FAC AMT PD,VETERANS/CHAMPVA(IMPUTED)",
  "FACILITY AMT PD,TRICARE(IMPUTED)",
  "FACILITY AMT PD, OTH FEDERAL (IMPUTED)",
  "FACILITY AMT PD, STATE/LOC GOV (IMPUTED)",
  "FACILITY AMT PD, WORKERS COMP (IMPUTED)",
  "FACILITY AMT PD, OTH PRIV (IMPUTED)",
  "FACILITY AMT PD, OTH PUB (IMPUTED)",
  "FACILITY AMT PD, OTH INSUR (IMPUTED)",
  "FACILITY SUM PAYMENTS ERFSF16X-ERFOT16X",
  "TOTAL FACILITY CHARGE (IMPUTED)",
  "DOCTOR AMOUNT PAID, FAMILY (IMPUTED)",
  "DOCTOR AMOUNT PD, MEDICARE (IMPUTED)",
  "DOCTOR AMOUNT PAID, MEDICAID (IMPUTED)",
  "DOCTOR AMT PD, PRIV INSUR (IMPUTED)",
  "DR AMT PD,VETERANS/CHAMPVA(IMPUTED)",
  "DOCTOR AMT PD,TRICARE(IMPUTED)",
  "DOCTOR AMT PAID, OTH FEDERAL (IMPUTED)",
  "DOCTOR AMT PD, STATE/LOC GOV (IMPUTED)",
  "DOCTOR AMOUNT PD, WORKERS COMP (IMPUTED)",
  "DOCTOR AMT PD, OTH PRIVATE (IMPUTED)",
  "DOCTOR AMT PD, OTH PUB (IMPUTED)",
  "DOCTOR AMT PD, OTH INSUR (IMPUTED)",
  "DOCTOR SUM PAYMENTS ERDSF16X - ERDOT16X",
  "TOTAL DOCTOR CHARGE (IMPUTED)",
  "IMPUTATION STATUS",
  "EXPENDITURE FILE PERSON WEIGHT, 2016",
  "VARIANCE ESTIMATION STRATUM, 2016",
  "VARIANCE ESTIMATION PSU, 2016")
emergency_visits_data <- clean_names(emergency_visits_data, case = c("snake"))
```

The data contains 6,832 observations (emergency room visits) and 66 variables. Some summary statistics of key variables are listed below.
```{r, echo = FALSE}
# Households
households <- emergency_visits_data %>% 
  count(dwelling_unit_id) %>%
  summarise(min_visits = min(n), 
            avg_visits = mean(n), 
            max_visits = max(n),
            sd_visits = sd(n),
            distinct_duid = (sum(n)/avg_visits)) %>%
  select(distinct_duid, min_visits, avg_visits, max_visits, sd_visits)

kable(households, col.names = c("Distinct Dwelling Units", 
                                "Miniumum Visits",
                                "Average Visits",
                                "Maximum Visits",
                                "Standard Deviation"), caption = "Households")

# Individuals
individuals <- emergency_visits_data %>% 
  count(person_id_duid_pid) %>%
  summarise(min_visits = min(n), 
            avg_visits = mean(n), 
            max_visits = max(n),
            sd_visits = sd(n),
            distinct_id = (sum(n)/avg_visits)) %>%
  select(distinct_id, min_visits, avg_visits, max_visits, sd_visits)

kable(individuals, col.names = c("Number of Individuals", 
                                "Miniumum Visits",
                                "Average Visits",
                                "Maximum Visits",
                                "Standard Deviation"), caption = "Individuals")

# Total Expenditures
expenditures <- emergency_visits_data %>% 
 mutate(expensiveness = cut(tot_exp_for_event_erfxp16x_erdxp16x, 
                            c(0, 500, 1000, 5000, 10000, 50000, 100000, 200000))) %>%
  select(tot_exp_for_event_erfxp16x_erdxp16x, expensiveness)

levels(expenditures$expensiveness) = c("< $500","$500 - $1,000", "$1000 - $5000", "$5000 - $10000", "$10000 - $50000", "50000 - $100000", "100000 - $200000")

count <- expenditures %>% 
  count(expensiveness)
kable(count, col.names = c("Total Expenditure", "Emergency Room Visits"), caption = "Expenditures")
  
```






